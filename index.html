<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connexion Phantom Wallet</title>
  <style>
    body { background: #1e1e2f; color: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: Arial, sans-serif;}
    h1 { margin-bottom: 18px; }
    button { padding: 15px 32px; margin: 16px 0; font-size: 1.2em; border-radius: 8px; border: none; background: #00ffa3; color: #1e1e2f; cursor: pointer;}
    input { margin: 12px 0; padding: 10px 15px; border-radius: 8px; border: none; width: 260px;}
    #manual { display: block; width: 100%; max-width: 350px; }
    .info { font-size:0.99em; color:#aaa; margin-bottom: 20px; }
    .hide { display: none; }
    #success { color: #00ffa3; font-size: 1.1em; margin-top: 30px; }
  </style>
</head>
<body>
  <h1>Connecter votre Phantom Wallet</h1>
  <button id="phantom-connect">Connecter via Phantom</button>
  <div id="manual">
    <div class="info">
      <b>Pas Phantom ?</b><br>
      <a href="https://phantom.app/download" style="color:#00ffa3;" target="_blank">Téléchargez Phantom ici</a>.<br>
      <br>
      <b>Ou connectez manuellement :</b>
    </div>
    <input id="pubkey" placeholder="Collez votre adresse publique Solana" autocomplete="off" />
    <button id="send-pubkey">Envoyer</button>
    <div class="info" style="font-size:0.93em;">
      Pour trouver votre clé publique dans Phantom :<br>
      <b>Ouvrez l’app → compte → crayon → “adresses du compte”.</b>
    </div>
  </div>
  <div id="success" class="hide">✅ Connexion envoyée au bot Telegram !</div>
  <script>
    window.Telegram.WebApp.ready();

    document.getElementById('phantom-connect').onclick = async () => {
      console.log('→ Bouton CONNECT cliqué');
      Telegram.WebApp.showAlert('DEBUG: click CONNECT');
      if (window.solana && window.solana.isPhantom) {
        try {
          const resp = await window.solana.connect();
          const pubkey = resp.publicKey.toString();
          Telegram.WebApp.sendData(JSON.stringify({ pubkey }));
          document.getElementById('success').classList.remove('hide');
        } catch (e) {
          Telegram.WebApp.showAlert("Erreur connexion Phantom : " + e);
        }
      } else {
        // Proposer deux options seulement, PAS de message mobile/PC
        document.getElementById('manual').classList.remove('hide');
        document.getElementById('phantom-connect').innerText = "Phantom non détecté. Utilisez une option ci-dessous :";
      }
    };

    document.getElementById('send-pubkey').onclick = () => {
      const pk = document.getElementById('pubkey').value.trim();
      console.log('→ Bouton ENVOYER cliqué, pk =', pk);
      Telegram.WebApp.showAlert('DEBUG: Envoi pubkey ' + pk);
      if (pk.length < 32) {
        Telegram.WebApp.showAlert("Adresse publique invalide.");
        return;
      }
      Telegram.WebApp.sendData(JSON.stringify({ pubkey: pk }));
      document.getElementById('success').classList.remove('hide');
    };
  </script>
</body>
</html>
