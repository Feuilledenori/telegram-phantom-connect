<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connexion Phantom Wallet</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-family: Arial, sans-serif; background: linear-gradient(135deg, #1e1e2f, #28293d); color: #fff; text-align: center; }
    #mainContent, #fallback { width: 90%; max-width: 360px; margin: auto; }
    h1 { margin-bottom: 16px; font-size: 1.8rem; }
    p { margin-bottom: 24px; line-height: 1.5; font-size: 1rem; color: #e0e0e0; }
    button, .submit { display: block; width: 100%; padding: 12px; font-size: 1rem; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: background-color 0.2s ease; margin-bottom: 12px; text-align: center; background-color: #00ffa3; color: #1e1e2f; }
    button:hover { background-color: #00cc82; }
    input { width: calc(100% - 16px); margin-bottom: 12px; padding: 8px; border: 1px solid #444; border-radius: 6px; background: #1e1e2f; color: #fff; font-size: 1rem; text-align: center; }
    .submit { background: #0055dd; color: #fff; }
    .submit:hover { background: #0044bb; }
    .hidden { display: none; }
    .instructions { text-align: left; font-size: 0.9rem; color: #c0c0c0; margin-bottom: 16px; }
  </style>
</head>
<body>
  <div id="mainContent">
    <h1>ðŸ‘› Connecter votre Phantom Wallet</h1>
    <p>Pour trader via smart contract, cliquez ci-dessous.</p>
    <button id="connect">Connecter via Phantom</button>
  </div>
  <div id="fallback" class="hidden">
    <p>Phantom non dÃ©tectÃ©. Options :</p>
    <button id="downloadPhantom">TÃ©lÃ©charger Phantom</button>
    <div class="instructions">
      <p><strong>Ou copier manuellement la clÃ© publique :</strong></p>
      <ol>
        <li>Ouvrez Phantom, avatar âž” crayon âž” "Adresses du compte".</li>
      </ol>
    </div>
    <input type="text" id="pubkeyInput" placeholder="Collez votre clÃ© publique Solana" />
    <button class="submit" id="sendPubkey">Envoyer</button>
  </div>

  <script>
    Telegram.WebApp.ready();

    const connectBtn = document.getElementById('connect');
    const mainContent = document.getElementById('mainContent');
    const fallback = document.getElementById('fallback');
    const downloadBtn = document.getElementById('downloadPhantom');
    const input = document.getElementById('pubkeyInput');
    const sendBtn = document.getElementById('sendPubkey');
    const downloadUrl = 'https://phantom.app/download';

    connectBtn.addEventListener('click', async () => {
      Telegram.WebApp.showAlert('Connect button clicked');
      if (window.solana && window.solana.isPhantom) {
        try {
          const resp = await window.solana.connect();
          Telegram.WebApp.showAlert('Connected: ' + resp.publicKey.toString());
          Telegram.WebApp.sendData(JSON.stringify({ pubkey: resp.publicKey.toString() }));
          Telegram.WebApp.close();
          return;
        } catch (err) {
          console.error('Erreur Phantom connect:', err);
          Telegram.WebApp.showAlert('Erreur de connexion Phantom');
        }
      }
      mainContent.classList.add('hidden');
      fallback.classList.remove('hidden');
    });

    downloadBtn.addEventListener('click', () => {
      Telegram.WebApp.showAlert('TÃ©lÃ©charger Phantom');
      window.open(downloadUrl, '_blank');
    });

    sendBtn.addEventListener('click', () => {
      Telegram.WebApp.showAlert('Envoyer button clicked');
      const pk = input.value.trim();
      if (pk.length > 0) {
        Telegram.WebApp.showAlert('Sending pubkey: ' + pk);
        Telegram.WebApp.sendData(JSON.stringify({ pubkey: pk }));
        Telegram.WebApp.close();
      } else {
        Telegram.WebApp.showAlert('ClÃ© publique invalide');
      }
    });
  </script>
</body>
</html>
